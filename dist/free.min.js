!function(){var e={content:'<div class="free-alert-content" />',buttons:'<div class="free-alert-btns"><button class="free-alert-ok">确定</button></div>'};$.extend(!0,window,{free:{alert:function(t){var n=$(e.buttons),o=free.dialog({title:'<div class="free-alert-title"><i class="icon"></i>提示</div>',content:$(e.content).append(t||""),footer:n,containerClass:"free-alert-box",escClose:!1,blankClose:!1});n.find("button.free-alert-ok").one("click",function(){o.close()})}}})}(),function(){var e={title:'<div class="free-confirm-title"><i class="icon"></i></div>',content:'<div class="free-confirm-content" />',buttons:'<div class="free-confirm-btns"><button class="free-confirm-cancel">取消</button><button class="free-confirm-ok">确定</button></div>'},t={title:"提示",content:"您确定这样做吗？",ok:null,cancel:null};$.extend(!0,window,{free:{confirm:function(n){var o=$.extend({},t,n),i=$(e.buttons),a=free.dialog({title:$(e.title).append(o.title),content:$(e.content).append(o.content),footer:i,escClose:!1,blankClose:!1,containerClass:"free-confirm-box",onCloseBtnClick:function(){"function"==typeof o.cancel&&o.cancel()}});i.find("button.free-confirm-ok").one("click",function(){a.close(),"function"==typeof o.ok&&o.ok()}),i.find("button.free-confirm-cancel").one("click",function(){a.close(),"function"==typeof o.cancel&&o.cancel()})}}})}(),function(){function e(){a=$(p.wrapper),s=$(p.container),r=$(p.close),d=$(p.header).html(u.title),c=$(p.content).html(u.content),l=$(p.footer),c.css("max-height",$(window).height()-200),s.append(r).append(d).append(c).appendTo(a),u.footer&&s.append(l.append(u.footer)),a.appendTo("body"),u.containerClass&&s.addClass(u.containerClass),n()}function t(e){27===e.which&&i()}function n(){r.on("click",function(){"function"==typeof u.onCloseBtnClick&&u.onCloseBtnClick(),i()}),u.escClose&&$("body").on("keydown",t),u.blankClose&&a.on("click",function(e){$(e.target).is(".free-dialog-wrapper")&&i()})}function o(){u.escClose&&$("body").off("keydown",t)}function i(){"function"==typeof u.onClose&&u.onClose(),o(),a.remove()}var a,s,r,d,c,l,f={title:"",content:"",footer:"",blankClose:!1,escClose:!0,onClose:null,onCloseBtnClick:null,containerClass:""},p={wrapper:'<div class="free-dialog-wrapper v-center free-modal" />',container:'<div class="free-dialog-container" />',close:'<button class="free-dialog-close"><span class="close-x"></span></button>',header:'<div class="free-dialog-header" />',content:'<div class="free-dialog-content" />',footer:'<div class="free-dialog-footer" />'},u={};$.extend(!0,window,{free:{dialog:function(t){return u=$.extend({},f,t),e(),a.show(),a.close=i,a}}})}(),function(){function e(e,t){var n=e.offset(),o=e.outerWidth();e.outerHeight();return{top:n.top-(t.outerHeight()+i),left:n.left-(t.outerWidth()-o)/2}}function t(e,t){var n=e.offset(),o=e.outerWidth(),a=e.outerHeight();return{top:n.top-(t.outerHeight()-a)/2,left:n.left+o+i}}function n(e,t){var n=e.offset(),o=(e.outerWidth(),e.outerHeight());return{top:n.top-(t.outerHeight()-o)/2,left:n.left-t.outerWidth()-i}}function o(e,t){var n=e.offset(),o=e.outerWidth(),a=e.outerHeight();return{top:n.top+a+i,left:n.left-(t.outerWidth()-o)/2}}var i=8,a={warpper:'<div class="free-popbox-wrapper"/>',container:'<div class="free-popbox-box"/>',content:'<div class="free-popbox-content"/>',anchor:'<div class="free-popbox-anchor"/>'},s={position:"top",content:"",onClose:null},r={top:e,right:t,left:n,bottom:o},r={top:e,right:t,left:n,bottom:o};$.fn.popbox=function(e){function t(){"function"==typeof n.onClose&&n.onClose(f),i.remove()}var n=$.extend({},s,e),o=$(this),i=$(a.warpper),d=$(a.container),c=$(a.content),l=$(a.anchor);d.append(c.html(n.content)).append(l),i.append(d).appendTo("body"),d.css(r[n.position](o,c)),c.addClass(n.position),l.addClass(n.position),setTimeout(function(){$("body").one("click",function(e){t()})},0),d.on("click",function(){return!1});var f={close:t,repin:function(){d.css(r[n.position](o,c))}};return"function"==typeof n.onShow&&n.onShow(f),f}}(),function(e){function t(e){var t=Date.now();return function(n){Date.now()-t<$||(e.call(this,n),t=Date.now())}}function n(t,n,o,i){e('<input class="free-default-editor free"/>').val(o[n.id]||"").on("keydown",function(t){13==t.keyCode?i(e(this).val()):27==t.keyCode&&i()}).on("blur",function(e){i()}).appendTo(t.empty()).select().focus()}function o(e,t){return null==e[t.id]?"":e[t.id]}function i(e,t){var i,a,s=[];e.selectable&&s.push('<th class="free-table-selector"><input type="checkbox"/></th>');for(var r,d={},c=0,l=t.length;c<l;c++){if(null==(i=t[c]).id)throw"Each column must have an unique id";d[i.id]=i,i.min_width=i.min_width||e.minWidth,i.width&&i.min_width>i.width&&(i.min_width=i.width),a=i.width||i.min_width,r="",i.hide&&(r+=" hide"),i.editable&&(r+=" editable","function"!=typeof i.editor&&(i.editor=n)),"function"!=typeof i.formatter&&(i.formatter=o),e.enableColumnReorder&&(r+=" movable"),(r=r.trim())&&(r="class="+r),s.push("<th "+r+" x-id="+i.id+' width="'+a+'px"><span class="text">'+i.name+"</span>"+(e.enableColumnResize?'<span class="resize-handler"/>':"")+(i.sort?'<span class="sort-handler"/>':"")+"</th>")}return e.colMap=d,s.join("")}function a(t,n,o){var i=[];o.selectable&&i.push('<td class="free-table-selector"><input type="checkbox"/></td>');for(var a,s,r,d,c=0,l=t.length;c<l;c++)(s=t[c]).id,r=s.formatter(n,s)+"",a=s.escape?e("<i/>").text(r).html():r,d=[],s.hide&&d.push("hide"),s.editable&&d.push("editable"),s.cssClass&&d.push(s.cssClass),a=d.length>0?'<td class="'+d.join(" ")+'">'+a+"</td>":"<td>"+a+"</td>",i.push(a);return"<tr>"+i.join("")+"</tr>"}function s(e,t){for(var n=e.columns,o=[],i=0,s=t.length;i<s;i++)o.push(a(n,t[i],e));return o}function r(e,t){e.$pageBox.twbsPagination("destroy");var n=Math.ceil(t/e.pageSize);e.$pageBox.twbsPagination({totalPages:n,visiblePages:7,hideOnlyOnePage:!0,initiateStartPageClick:!1,onPageClick:function(t,n){f(e,!1,n-1)}}).show(),c(e,n)}function d(e,t){var n=e.$pageBox.find("input");n.hasClass("error")&&n.removeClass("error");var o=n.val(),i=parseInt(o);if(isNaN(i)||i<1||i>t)return free.message("Invalid page number. Max page: "+t,"error"),void e.$pageBox.find("input").addClass("error");e.$pageBox.twbsPagination("getCurrentPage")!=i&&e.$pageBox.twbsPagination("show",i)}function c(t,n){n>7?(t.$pageBox.append('<div class="goto"><input class="free-input" type="number"/><button class="free-btn default">Go</button></div>'),t.$pageBox.find(".goto > button").on("click",function(e){d(t,n)}),t.$pageBox.find(".goto > input").on("keydown",function(e){13===e.keyCode&&d(t,n)}),t.$pageBox.find(".goto > input").on("focus",function(t){e(this).removeClass("error")})):t.$pageBox.find(".goto").remove()}function l(t,n){var o=t.$tableBox.find("tbody");o.empty(),n.length>0?(o.append(s(t,n)),o.find("tr").each(function(t){e(this).data("item",n[t])})):t.$pageBox.hide(),C(t.$tableBox),"client"==t.sortType&&x(t.$tableBox)}function f(e,t,n){var o=e.url,i=e.params,a=e.prepare,s=e.pagination;i=i||{},n=n||0,i.page=n,free.doGet(o,i,function(o){a&&(o=a(o));var i,d;Array.isArray(o)?(i=o.length,d=o):(i=o.total,d=o.items),g(d),e.data=d,l(e,d),e.info&&p(e,n+1,Math.ceil(i/e.pageSize),i),!s||i<=e.pageSize?e.$pageBox.hide():t&&r(e,i),e.onLoad(d)})}function p(e,t,n,o){e.pagination&&(e.$infoBox.find("span.page-num").text(t),e.$infoBox.find("span.page-sum").text(n)),e.$infoBox.find("span.sum").text(o)}function u(e,t,n){for(var o=e.$tableBox,i="hide"==n,a=0;a<t.length;a++){var s=t[a],r=o.find("thead th[x-id="+s+"]"),d=r.index()+1;e.colMap[s].hide=i,i?(r.addClass("hide"),o.find("tbody > tr > td:nth-child("+d+")").addClass("hide")):(r.removeClass("hide"),o.find("tbody > tr > td:nth-child("+d+")").removeClass("hide"))}y(o,e)}function h(n,o){function i(t,n){for(var o=Math.min(t,n),i=Math.max(t,n),a=l.find("tbody > tr").slice(o,i+1),s=!0,r=0,d=a.length;r<d;r++)if(!e(a[r]).hasClass("selected")){s=!1;break}return{select:!s,rows:a}}function a(e){for(var t=e.next();t.length>0&&t.hasClass("hide");)t=t.next();return t}function s(e){for(var t=e.prev();t.length>0&&(t.hasClass("hide")||t.hasClass("free-table-selector"));)t=t.prev();return t}function r(e,t){var n=s(t),o=a(t),i=l.offset();e.prev=n,e.next=o,e.left=n.length>0?n.offset().left+n.outerWidth()/2-i.left:0,e.right=o.length>0?o.offset().left-i.left:l.outerWidth()}function d(e){var t=l.find("thead").data("reorder-info"),n=t.$th;n.hasClass("moving")||n.addClass("moving");var o=t.offset.left+e.clientX-t.eX-t.tableOffset.left;o<t.leftMost&&(o=t.leftMost),o>t.rightMost&&(o=t.rightMost);var i=t.prev,a=t.next;o<t.left&&i.length>0?(i.before(n.detach()),r(t,n)):o>t.right&&a.length>0&&(a.after(n.detach()),r(t,n)),n.css("left",o)}function c(e){var t=l.find("thead").data("resize-info"),n=t.$th,i=o.colMap[n.attr("x-id")].min_width,a=e.clientX-t.eX,s=t.width+a;s<i&&(s=i),n.width(s),l.width(t.tableWidth+(s-t.width)),o.info&&o.$infoBox.width(t.infoWidth+(s-t.width))}var l=o.$tableBox;o.selectable&&(l.find("th.free-table-selector > input").on("change",function(){var t=e(this).prop("checked");l.find("tbody td.free-table-selector > input").prop("checked",t),t?l.find("tbody tr").addClass("selected"):l.find("tbody tr").removeClass("selected")}),l.on("click","thead .free-table-selector",function(t){e(t.target).is("input")||e(this).find("input").trigger("click")}),l.on("click","tbody .free-table-selector",function(t){var n=e(this),a=e(t.target),s=l.find("th.free-table-selector").data("last-click"),r=n.parent(),d=r.index();if(null!=s&&s!=d&&t.shiftKey){var c=i(s,d);c.select?(e(c.rows).addClass("selected"),e(c.rows).find("input").prop("checked",!0)):(e(c.rows).removeClass("selected"),e(c.rows).find("input").prop("checked",!1))}else if(r.toggleClass("selected"),!a.is("input")){var f=n.find("input");f.prop("checked",!f.prop("checked"))}var p=l.find("tbody tr:not(.selected)");l.find("th.free-table-selector input").prop("checked",0===p.length),"function"==typeof o.onSelectChange&&o.onSelectChange(),l.find("th.free-table-selector").data("last-click",d)})),o.enableColumnHide&&l.find("thead").on("contextmenu",function(t){t.preventDefault(),e(".free-table-header-menu").remove();var i=e('<div class="free-table-header-menu"></div>');i.appendTo("body");var a=t.pageX,s=t.pageY;i.css({top:s,left:a});for(var r=o.columns,d=[],c=0;c<r.length;c++)d.push('<div class="item" x-id="'+r[c].id+'"><input type="checkbox"'+(r[c].hide?"":"checked")+'/><span class="name">'+r[c].name+"</span></div>");i.append(d.join("")),i.on("click",".item",function(t){if(!e(t.target).is("input")){var n=e(this).find("input");n.prop("checked",!n.prop("checked")).change()}}),i.on("click",function(e){e.stopPropagation()}),e("body").one("click",function(e){i.remove()}),l.one("click",function(e){i.remove()}),i.on("change",".item > input",function(t){var i=e(this).parent().attr("x-id"),a=n.find("thead th[x-id="+i+"]");o.colMap[i].hide=!e(this).prop("checked");var s=a.index()+1,r=n.find("tbody > tr > td:nth-child("+s+")");a.toggleClass("hide"),r.toggleClass("hide"),y(l,o)})}),l.on("click","thead > th > .sort-handler",function(){var t=e(this),n=t.parent().attr("x-id");t.hasClass("sort-desc")?(t.removeClass("sort-desc").addClass("sort-asc"),"client"==o.sortType?m(o,n):b(o,n,"asc")):t.hasClass("sort-asc")?(t.removeClass("sort-desc sort-asc"),"client"==o.sortType?m(o,"free-index"):b(o)):(l.find("thead > th > .sort-handler").removeClass("sort-asc sort-desc"),t.addClass("sort-desc"),"client"==o.sortType?m(o,n,-1):b(o,n,"desc"))}),o.enableColumnReorder&&l.find("thead > th.movable").on("mousedown",function(n){if(!e(n.target).hasClass("sort-handler")&&!e(n.target).hasClass("resize-handler")){n.preventDefault();var i=e(this),a={$th:i,index:i.index(),eX:n.clientX,eY:n.clientY,tableOffset:l.offset(),offset:i.offset(),leftMost:-i.outerWidth(),rightMost:l.outerWidth()+10};r(a,i),i.parent().data("reorder-info",a);var s=t(d);e(document).on("mousemove",s),e(document).one("mouseup",function(t){var n=l.find("thead"),i=n.data("reorder-info"),a=i.$th;i.delta;v(o,i.index-1,a.index()-1),n.data("reorder-info",null),a.removeClass("moving"),e(document).off("mousemove",s)})}}),o.enableColumnResize&&l.on("mousedown","thead > th > .resize-handler",function(n){n.preventDefault();var i=e(this).parent();l.find("thead").data("resize-info",{$th:i,width:i.width(),tableWidth:l.width(),infoWidth:o.$infoBox.width(),eX:n.clientX});var a=t(c);e(document).on("mousemove",a),e(document).one("mouseup",function(t){l.find("thead").data("resize-info",null),e(document).off("mousemove",a)})}),l.on("dblclick","td.editable",function(t){var n=e(this),i=l.find("thead > th").eq(n.index()).attr("x-id"),a=o.colMap[i],s=n.parent().data("item");n.addClass("editing"),a.editor(n,a,s,function(e){null!=e&&(s[a.id]=e,"function"==typeof a.onSubmit&&a.onSubmit(e,a,s)),n.empty().append(a.formatter(s,a)).removeClass("editing")})})}function v(t,n,o){if(n!==o){var i=t.columns,a=i[n];i.splice(n,1),i.splice(o,0,a),t.selectable&&(n+=1,o+=1),t.$tableBox.find("tbody > tr").each(function(t,i){var a=e(i).find("td").detach(),s=a[n];a.splice(n,1),a.splice(o,0,s),e(i).empty().append(a)})}}function m(t,n,o){o=o||1;var i=t.$tableBox.find("tbody > tr").detach();i.sort(function(t,i){var a=e(t).data("item")[n],s=e(i).data("item")[n];if("number"==typeof a&&"number"==typeof s)return o*(a-s);var r=0;return(a+="")<(s+="")?r=-1:a>s&&(r=1),r*o}),t.$tableBox.find("tbody").append(i)}function b(e,t,n){e.params=e.params||{},null==t?(delete e.params["order-key"],delete e.params["order-type"]):(e.params["order-key"]=t,e.params["order-type"]=n),f(e,!0)}function g(e){for(var t=0,n=e.length;t<n;t++)e[t]["free-index"]=t;return e}function x(e){e.find("th > .sort-handler").removeClass("sort-asc sort-desc")}function C(e){e.find("th.free-table-selector input").prop("checked",!1)}function y(e,t){var n=0,o=t.columns;t.selectable&&(n+=w);for(var i=0,a=o.length;i<a;i++)o[i].hide||(n+=o[i].width||t.minWidth);e.css("width",n),t.info&&t.$infoBox.css("width",n)}var w=35,$=100,k={pagination:!1,columns:[],url:"",params:null,data:[],info:!0,minWidth:80,pageSize:30,sortType:"client",selectable:!1,enableColumnResize:!1,enableColumnReorder:!1,enableColumnHide:!1,onLoad:function(){}};e.fn.table=function(t){var n=this,o=e('<div class="info-box"><span class="page-info">第&nbsp;<span class="page-num">1</span>&nbsp;页，共&nbsp;<span class="page-sum"></span>&nbsp;页，</span>总共&nbsp;<span class="sum"></span>&nbsp;条数据</div>'),s=e('<div class="table-box"><table><thead></thead><tbody></tbody></table></div>'),r=e('<div class="page-box"></div>'),d=t.data;delete t.data;var c=e.extend(!0,{$infoBox:o,$tableBox:s,$pageBox:r},k,t);return d&&(c.data=d,t.data=d),n.addClass("free-table-container"),c.info&&n.append(o),n.append(s),c.pagination?n.append(r):o.find(".page-info").hide(),y(s,c),s.find("thead").append(i(c,c.columns)),c.url?f(c,!0):c.data&&(l(c,g(c.data)),c.info&&p(c,1,1,c.data.length)),h(n,c),{$self:n,refresh:function(){f(c,!0)},setColumns:function(t){c.columns=e.extend([],t),s.find("thead").empty().append(i(c,t))},setData:function(e){l(c,e)},insert:function(e,t){var n=s.find("tbody tr:eq("+t+")"),o=a(c.columns,e);0===n.length?s.find("tbody").append(o):n.before(o),C(s)},remove:function(e){s.find("tbody tr:eq("+e+")").remove()},setParams:function(e){c.params=e,f(c,!0),x(c.$tableBox)},getSelected:function(){var t=s.find("tr.selected"),n=[];return t.each(function(t,o){n.push(e(o).data("item"))}),{rows:t,items:n}},isSelected:function(e){return s.find("tr:eq("+e+")").hasClass("selected")},clearSelect:function(){s.find("tr.selected").removeClass("selected"),s.find(".free-table-selector input").prop("checked",!1)},destroyHeaderMenu:function(){e(".free-table-header-menu").remove()},showColumns:function(e){u(c,e,"show")},hideColumns:function(e){u(c,e,"hide")}}}}(jQuery),function(){function e(){o=$(s.container).appendTo("body")}function t(t){o||e();var n=$(s.box).addClass(t.type);$(s.icon).addClass(t.type).appendTo(n),$(s.title).text(t.title).appendTo(n),$(s.content).text(t.message).appendTo(n),$(s.close).appendTo(n).on("click",function(){n.remove()}),n.appendTo(o),setTimeout(function(){n.remove()},t.duration)}function n(e,t){var n={title:i[e]||i.info,message:t[0]||"",duration:a,type:e};return 2===t.length&&("number"==typeof t[1]?n.duration=parseInt(t[1]):n.title=t[1]||n.title),3===t.length&&(n.title=t[1]||n.title,n.duration=parseInt(t[2])||a),n}var o,i={success:"成功",error:"错误",info:"提示",warn:"警告"},a=4e3,s={container:'<div class="free-noty-container"/>',icon:'<span class="free-noty-icon success"></span>',box:'<div class="free-noty-box"/>',title:'<div class="free-noty-title"/>',content:'<div class="free-noty-content"/>',close:'<span class="free-noty-close"></span>'};$.extend(!0,window,{free:{noty:{success:function(e,o,i){t(n("success",arguments))},info:function(e,o,i){t(n("info",arguments))},error:function(e,o,i){t(n("error",arguments))},warn:function(e,o,i){t(n("warn",arguments))}}}})}();